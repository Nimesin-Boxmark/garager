#!/usr/bin/env ruby

require 'fileutils'
require 'tempfile'

BUNDLE="/usr/local/bin/bundle"
DIR="/home/pi/perfect_pi"
LOG="/root"

logger = Logger.new(File.join(DIR, "log", "startup.log"))

begin
  case ARGV.first
  when /start/
    FileUtils.cd(DIR)
    command = "#{BUNDLE} rackup -p 3000"
    logger.info "exec: #{command}"
    exec command
  end
rescue => e
  logger.error %[#{e.class.to_s}\n#{e.backtrace.join("\n")}]
end
